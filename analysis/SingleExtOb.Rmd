---
title: "When only the most extreme observation is known"
author: "Lei Sun"
date: 2017-02-27
output: html_document
---

```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("chunks.R")
```

```{r knitr-opts-chunk, include=FALSE}
```

**Last updated:** `r Sys.Date()`

**Code version:** `r workflowr::extract_commit(".", 1)$sha1`

## Introducation

Matthew had an idea that what if the only thing we know is the most extreme observation $(\hat\beta_{(n)}, \hat s_{(n)})$, as well as the total number of observations $n$.  What does this single data point tell us?

## Model

Start with our usual `ash` model.

$$
\begin{array}{c}
\hat\beta_j | \hat s_j, \beta_j \sim N(\beta_j, \hat s_j^2)\\
\beta_j \sim \sum_k\pi_k N(0, \sigma_k^2)
\end{array}
$$
Now we only observe $(\hat\beta_{(n)}, \hat s_{(n)})$ with the information that $|\hat\beta_{(n)}/\hat s_{(n)}| \geq |\hat\beta_{j}/\hat s_{j}|$, $j = 1, \ldots, n$.  This is essentially separating $n$ observations into two groups.

$$
\text{Group 1: }(\hat\beta_{(1)}, \hat s_{(1)}), \ldots, (\hat\beta_{(n - 1)}, \hat s_{(n - 1)}), \text{ with } |\hat\beta_j/\hat s_j| \leq t = |\hat\beta_{(n)}/\hat s_{(n)}|
$$
$$
\text{Group 2: }(\hat\beta_{n}, \hat s_{n}), \text{ with } |\hat\beta_{(n)}/\hat s_{(n)}| = t
$$
Or in other words, it should be equivalent to `truncash` using the threshold $t = |\hat\beta_{(n)}/\hat s_{(n)}|$, at least from the likelihood principle point of view.

## Back-of-the-envelope calculation

Suppose $X_1 \sim F_1, X_2\sim F_2, \ldots, X_n \sim F_n$, with $F_i$ being the cdf of the random variable $X_i$, with a pdf $f_i$.  In `ash`'s setting, we can think of $X_i = |\hat\beta_i/ \hat s_i|$, and $f_i$ is the convolution of a common unimodel distribution $g$ (to be estimated) and the idiosyncratic likelihood of $|\hat\beta_j / \hat s_j|$ given $\hat s_j$ (usually related to normal or Student's t, but could be generalized to others).  Let $X_{(n)}:=\max\{X_1, X_2, \ldots, X_n\}$, the extreme value of these $n$ random variables.

$$
\begin{array}{rl}
& P(X_{(n)} \leq t) = \Pi_{i = 1}^n F_i(t) \\
\Rightarrow & p_{X_{(n)}}(t) = dP(X_{(n)} \leq t)/dt = 
\end{array}
$$

## Simulation





## Session Information

```{r session-info}
```
